<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Dashboard</title>
</head>
<body>
  <h1>My Notebooks</h1>
  <p><a href="/">Back to home</a></p>

  <form id="createForm">
    <input type="text" name="name" placeholder="New notebook name" required />
    <button type="submit">Create</button>
  </form>

  <input type="text" id="searchBox" placeholder="Search notebooks..." />

  <ul id="notebookList">
    <% notebooks.forEach(nb => { %>
      <li data-name="<%= nb.name.toLowerCase() %>">
        <strong><%= nb.name %></strong>
        <button onclick="location.href='/edit/<%= nb.id %>'">Edit</button>
        <button onclick="location.href='/notebook/<%= nb.id %>'">Read</button>
        <button onclick="deleteNotebook(<%= nb.id %>)">Delete</button>
      </li>
    <% }) %>
  </ul>

  <script>
    // Create notebook
    document.getElementById('createForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(e.target);
      const name = formData.get('name');

      const res = await fetch('/api/notebooks', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name })
      });

      const data = await res.json();
      if (data.ok) {
        location.reload();
      } else {
        alert(data.error || 'Error creating notebook');
      }
    });

    // Delete notebook
    async function deleteNotebook(id) {
      if (!confirm('Are you sure you want to delete this notebook?')) return;
      const res = await fetch(`/api/notebooks/${id}`, { method: 'DELETE' });
      const data = await res.json();
      if (data.ok) {
        location.reload();
      } else {
        alert('Error deleting notebook');
      }
    }

    // Search filter
    document.getElementById('searchBox').addEventListener('input', function() {
      const query = this.value.toLowerCase();
      document.querySelectorAll('#notebookList li').forEach(li => {
        const name = li.getAttribute('data-name');
        li.style.display = name.includes(query) ? '' : 'none';
      });
    });
  </script>
</body>
</html>